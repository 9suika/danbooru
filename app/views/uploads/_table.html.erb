<div class="flex items-center mb-2">
  <h1 class="flex-1">My Uploads</h1>

  <span>
    <%= link_to "Gallery", uploads_path(mode: "gallery") %> |
    <strong>Table</strong>
  </span>
</div>

<%= table_for @uploads, class: "striped autofit", width: "100%" do |t| %>
  <% t.column "Upload", td: { class: "text-center" } do |upload| %>
    <% if upload.media_asset_count >= 1 && upload.upload_media_assets.sort_by(&:id).first&.media_asset.present? %>
      <% media_asset = upload.upload_media_assets.sort_by(&:id).first.media_asset %>

      <%= render MediaAssetPreviewComponent.new(media_asset: media_asset, link_target: upload, save_data: CurrentUser.save_data, shrink_to_fit: false, classes: ["w-min mx-auto"]) do |preview| %>
        <% if upload.media_asset_count > 1 %>
          <% preview.header do %>
            <div class="media-asset-image-count-icon absolute top-0.5 right-0.5 p-1 m-0.5 leading-none rounded text-xs font-arial font-bold">
              <%= multiple_images_icon %>
              <span class="align-middle"><%= upload.media_asset_count %></span>
            </div>
          <% end %>
        <% elsif upload.media_asset_count == 1 && media_asset.post.present? %>
          <% preview.footer do %>
            <%= link_to "post ##{media_asset.post.id}", media_asset.post, class: "text-center text-xs" %>
          <% end %>
        <% end %>
      <% end %>
    <% else %>
      <%= link_to "upload ##{upload.id}", upload %>
    <% end %>
  <% end %>

  <% t.column "Info", td: { class: "col-expand" } do |upload| %>
    <div>
      <strong>Upload</strong>
      <span><%= link_to "##{upload.id}", upload %></span>
    </div>

    <div>
      <strong>Source</strong>
      <span>
        <% if upload.source.present? %>
          <%= external_link_to upload.source %>
          <%= link_to "»", uploads_path(mode: "table", search: params[:search].merge(source_like: upload.source)) %>
        <% else %>
          <em>none</em>
        <% end %>
      </span>
    </div>

    <% if upload.referer_url.present? %>
      <div>
        <strong>Referrer</strong>
        <span>
          <%= external_link_to upload.referer_url %>
          <%= link_to "»", uploads_path(mode: "table", search: params[:search].merge(referer_url: upload.referer_url)) %>
        </span>
      </div>
    <% end %>

    <% if upload.is_errored? %>
      <div>
        <strong>Error</strong>
        <span>
          <%= upload.error %>
        </span>
      </div>
    <% end %>
  <% end %>

  <% t.column "Uploader" do |upload| %>
    <%= link_to_user upload.uploader %>
    <%= link_to "»", uploads_path(mode: "table", search: params[:search].merge(uploader_name: upload.uploader.name)) %>
    <div><%= time_ago_in_words_tagged upload.created_at %></div>
  <% end %>

  <% t.column :status do |upload| %>
    <%= upload.status %>
  <% end %>
<% end %>

<%= numbered_paginator(@uploads) %>
